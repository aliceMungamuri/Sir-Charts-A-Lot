<div class="timeline-container" *ngIf="events.length > 0 || isThinking">
  <!-- Header - Minimal design matching mockup -->
  <div class="flex items-center gap-2 cursor-pointer py-3 px-2 hover:text-gray-700 transition-colors" (click)="toggleExpanded()">
    <span *ngIf="isThinking" class="text-base font-semibold text-gray-700 shimmer-text">
      Thinking for {{ elapsedTime }} seconds...
    </span>
    <span *ngIf="!isThinking && thinkingDuration > 0" class="text-base font-semibold text-gray-600">
      Thought for {{ thinkingDuration }} seconds
    </span>
    <svg class="w-3 h-3 transition-transform text-gray-500" 
         [class.rotate-180]="isExpanded"
         fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </div>

  <!-- Timeline Events -->
  <div [class.timeline-collapsed]="!isExpanded" [class.timeline-expanded]="isExpanded" class="timeline-content overflow-hidden">
    <div class="space-y-4 px-4 pb-4" *ngIf="isExpanded">
      <div *ngFor="let event of events; let i = index; let isLast = last" class="timeline-event-enter timeline-event">
        <div class="flex gap-3 relative">
          <!-- Icon Column - Fixed Width -->
          <div class="flex-shrink-0 w-10 relative">
            <div class="w-10 h-10 rounded-full flex items-center justify-center text-base font-medium"
                 [ngClass]="{
                   'bg-blue-100 text-blue-600': event.agent === 'domain-expert',
                   'bg-purple-100 text-purple-600': event.agent === 'sql-expert',
                   'bg-green-100 text-green-600': event.agent === 'executor',
                   'bg-orange-100 text-orange-600': event.agent === 'viz-agent'
                 }">
              {{ getAgentIcon(event.agent) }}
            </div>
            <!-- Vertical line connector -->
            <div *ngIf="!isLast" class="absolute top-10 left-1/2 transform -translate-x-1/2 w-0.5 h-full bg-gray-300" style="height: calc(100% + 1rem);"></div>
          </div>

          <!-- Content Column -->
          <div class="flex-1 min-w-0 pt-2">
            <!-- Agent Name and Status -->
            <div class="flex items-center gap-2 mb-1">
              <span class="text-sm font-semibold" [ngClass]="getAgentColor(event.agent)">
                {{ getAgentName(event.agent) }}
              </span>
              <span *ngIf="event.status === 'completed'" class="text-green-500 text-sm">✓</span>
              <span *ngIf="event.status === 'active'" class="inline-block w-1.5 h-1.5 bg-primary rounded-full animate-pulse"></span>
              <span *ngIf="event.status === 'error'" class="text-red-500 text-sm">✗</span>
            </div>
            
            <!-- Message -->
            <p class="text-sm text-gray-700 leading-relaxed">{{ event.message }}</p>
            
            <!-- Details with proper indentation -->
            <div *ngIf="event.details && event.details.length > 0" class="mt-2 timeline-details">
              <div *ngFor="let detail of event.details" class="timeline-detail-item text-xs text-gray-600 mb-1">
                <span class="text-gray-400 flex-shrink-0">•</span>
                <span class="leading-relaxed">{{ detail }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>