<div class="fixed inset-0 flex bg-cream">
  <!-- Sidebar -->
  <aside class="w-sidebar bg-white border-r border-gray-200 flex flex-col h-full">
    <!-- Logo and Title -->
    <a routerLink="/home" class="px-4 py-5 flex items-center gap-2 hover:bg-gray-50 transition-colors">
      <span class="text-2xl">ðŸ“Š</span>
      <h1 class="text-lg font-semibold text-gray-900">Sir Charts-a-lot</h1>
    </a>
    
    <!-- Navigation -->
    <nav class="px-3 py-2">
      <a routerLink="/home" class="flex items-center gap-3 px-3 py-2 mb-1 rounded-lg text-gray-700 hover:bg-gray-100">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
        <span class="text-sm font-medium">Home</span>
      </a>
      
      <a routerLink="/chat" class="flex items-center gap-3 px-3 py-2 mb-1 rounded-lg bg-primary-dark text-white">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
        </svg>
        <span class="text-sm font-medium">Assistant</span>
      </a>
      
      <a routerLink="/enhanced-chat" class="flex items-center gap-3 px-3 py-2 mb-1 rounded-lg text-gray-700 hover:bg-gray-100">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg>
        <span class="text-sm font-medium">Enhanced Assistant</span>
      </a>
      
      <a routerLink="/my-collections" class="flex items-center gap-3 px-3 py-2 mb-1 rounded-lg text-gray-700 hover:bg-gray-100">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
        </svg>
        <span class="text-sm font-medium">My collections</span>
      </a>
      
      <a routerLink="/starred" class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-700 hover:bg-gray-100">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
        </svg>
        <span class="text-sm font-medium">Starred</span>
      </a>
    </nav>
    
    <!-- Spacer -->
    <div class="flex-1"></div>
  </aside>
  
  <!-- Main Content -->
  <div class="flex-1 flex flex-col h-full">
    <!-- Header Bar -->
    <div class="bg-white border-b border-gray-200 px-6 py-4 flex-shrink-0">
      <h2 class="text-lg font-medium text-gray-800">Current Session</h2>
      <p class="text-sm text-gray-500">{{ messages.length }} messages</p>
    </div>
    
    <!-- Messages Area -->
    <div class="flex-1 overflow-y-auto px-6 py-4 custom-scrollbar min-h-0" #scrollContainer>
      <div class="max-w-4xl mx-auto space-y-6">
        <!-- Empty state message -->
        <div *ngIf="messages.length === 0" class="text-center py-12 text-gray-500">
          <p>Start a conversation by typing a message below</p>
        </div>
        <div *ngFor="let message of messages; let i = index">
          <!-- User/Bot Message -->
          <div class="flex gap-4 mb-6">
            <!-- Avatar -->
            <div class="flex-shrink-0">
              <div [ngClass]="message.sender === 'user' ? 'bg-primary' : 'bg-primary-dark'" 
                   class="w-10 h-10 rounded-full flex items-center justify-center text-white">
                <!-- User icon -->
                <svg *ngIf="message.sender === 'user'" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <!-- Chart bot icon -->
                <svg *ngIf="message.sender === 'bot'" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
              </div>
            </div>
          
          <!-- Message Content -->
          <div class="flex-1">
            <div class="flex items-baseline gap-2 mb-1">
              <span class="font-medium text-gray-800">{{ message.sender === 'user' ? 'You' : 'Sir Charts-a-lot' }}</span>
              <span class="text-xs text-gray-500">{{ formatTime(message.timestamp) }}</span>
            </div>
            
            <!-- Thinking message or message with children -->
            <div *ngIf="message.isThinking || message.childMessages">
              <div class="bg-white rounded-lg shadow-sm">
                <!-- Timeline header -->
                <div *ngIf="message.timelineEvents && message.timelineEvents.length > 0" class="border-b border-gray-100">
                  <app-timeline
                    [events]="message.timelineEvents"
                    [isThinking]="message.isThinking"
                    [thinkingDuration]="message.thinkingDuration || 0">
                  </app-timeline>
                </div>
                
                <!-- Thinking animation if still thinking -->
                <div *ngIf="message.isThinking && (!message.timelineEvents || message.timelineEvents.length === 0)" class="p-4">
                  <div class="flex items-center gap-2 text-gray-500 text-sm">
                    <div class="flex gap-1">
                      <div class="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                      <div class="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                      <div class="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                    </div>
                    <span>{{ message.text }}</span>
                  </div>
                </div>
                
                <!-- Child messages (SQL, Visualization, Summary) -->
                <div *ngIf="message.childMessages && message.childMessages.length > 0" class="divide-y divide-gray-100">
                  <div *ngFor="let child of message.childMessages" [ngSwitch]="child.type">
                    <!-- SQL Query -->
                    <div *ngSwitchCase="'sql'" class="p-4">
                      <div class="bg-gray-900 rounded-lg p-4 relative group">
                        <div class="flex items-center justify-between mb-2">
                          <span class="text-xs text-gray-400 uppercase">SQL Query</span>
                          <button (click)="copyToClipboard(child.text)" 
                                  class="opacity-0 group-hover:opacity-100 transition-opacity bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">
                            {{ copiedMessageId === child.id ? 'âœ“ Copied' : 'Copy' }}
                          </button>
                        </div>
                        <pre class="text-gray-300 text-sm overflow-x-auto"><code>{{ child.text }}</code></pre>
                      </div>
                    </div>
                    
                    <!-- Visualization -->
                    <div *ngSwitchCase="'visualization'" class="p-4">
                      <apx-chart
                        [series]="child.chartOptions.series || []"
                        [chart]="child.chartOptions.chart || { type: 'bar', height: 350 }"
                        [xaxis]="child.chartOptions.xaxis"
                        [yaxis]="child.chartOptions.yaxis"
                        [title]="child.chartOptions.title"
                        [dataLabels]="child.chartOptions.dataLabels || { enabled: false }"
                        [stroke]="child.chartOptions.stroke"
                        [grid]="child.chartOptions.grid"
                        [tooltip]="child.chartOptions.tooltip"
                        [labels]="child.chartOptions.labels"
                        [legend]="child.chartOptions.legend"
                      ></apx-chart>
                    </div>
                    
                    <!-- Text Summary -->
                    <div *ngSwitchCase="'text'" class="p-4">
                      <p class="text-gray-700 whitespace-pre-wrap">{{ child.text }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Regular standalone messages (not part of a thinking message) -->
            <div *ngIf="!message.parentMessageId && !message.childMessages && !message.isThinking">
              <!-- Regular text message -->
              <div *ngIf="!message.isCode && message.type !== 'visualization'" class="bg-white rounded-lg shadow-sm">
                <!-- Show timeline header if this message has timeline events -->
                <div *ngIf="message.timelineEvents && message.timelineEvents.length > 0" class="border-b border-gray-100">
                  <app-timeline
                    [events]="message.timelineEvents"
                    [isThinking]="false"
                    [thinkingDuration]="message.thinkingDuration || 0">
                  </app-timeline>
                </div>
                <div class="p-4">
                  <p class="text-gray-700 whitespace-pre-wrap">{{ message.text }}</p>
                </div>
              </div>
              
              <!-- Code block -->
              <div *ngIf="message.isCode" class="bg-gray-900 rounded-lg p-4 shadow-sm relative group">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-xs text-gray-400 uppercase">SQL Query</span>
                  <button (click)="copyToClipboard(message.text)" 
                          class="opacity-0 group-hover:opacity-100 transition-opacity bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">
                    {{ copiedMessageId === message.id ? 'âœ“ Copied' : 'Copy' }}
                  </button>
                </div>
                <pre class="text-gray-300 text-sm overflow-x-auto"><code>{{ message.text }}</code></pre>
              </div>
              
              <!-- Chart visualization -->
              <div *ngIf="message.type === 'visualization' && message.chartOptions" class="bg-white rounded-lg shadow-sm">
                <!-- Show timeline header if this message has timeline events -->
                <div *ngIf="message.timelineEvents && message.timelineEvents.length > 0" class="border-b border-gray-100">
                  <app-timeline
                    [events]="message.timelineEvents"
                    [isThinking]="false"
                    [thinkingDuration]="message.thinkingDuration || 0">
                  </app-timeline>
                </div>
                <div class="p-4">
                  <apx-chart
                    [series]="message.chartOptions.series || []"
                    [chart]="message.chartOptions.chart || { type: 'bar', height: 350 }"
                    [xaxis]="message.chartOptions.xaxis"
                    [yaxis]="message.chartOptions.yaxis"
                    [title]="message.chartOptions.title"
                    [dataLabels]="message.chartOptions.dataLabels || { enabled: false }"
                    [stroke]="message.chartOptions.stroke"
                    [grid]="message.chartOptions.grid"
                    [tooltip]="message.chartOptions.tooltip"
                    [labels]="message.chartOptions.labels"
                    [legend]="message.chartOptions.legend"
                  ></apx-chart>
                </div>
              </div>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Input Area -->
    <div class="border-t border-gray-200 bg-white px-6 py-4 flex-shrink-0">
      <div class="max-w-4xl mx-auto">
        <div class="flex gap-3">
          <input 
            type="text" 
            [(ngModel)]="queryText"
            (keyup.enter)="sendQuery()"
            placeholder="Type your message here... Press Shift+Enter for new line"
            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          />
          <button 
            (click)="sendQuery()"
            [disabled]="!queryText.trim()"
            class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-light transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2">
            <span>Send</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
            </svg>
          </button>
        </div>
        <p class="text-xs text-gray-500 mt-2">Sir Charts-a-lot can make mistakes. Please double-check responses.</p>
      </div>
    </div>
  </div>
</div>